{
  "openapi": "3.1.0",
  "info": {
    "title": "Superseeded API",
    "description": "Modern nursery industry API for reconciling plant specifications, resolving equivalence and assessing logistical risks for plant stock.",
    "version": "1.0.0",
    "license": {
      "name": "MIT"
    },
    "contact": {
      "name": "Superseeded Support"
    }
  },
  "servers": [
    {
      "url": "https://api.superseeded.ai/v1",
      "description": "Production Server"
    }
  ],
  "tags": [
    {
      "name": "Resolvers",
      "description": "Endpoints for cleaning, normalizing, and interpreting messy nursery data."
    },
    {
      "name": "Validation",
      "description": "Endpoints for validating botanical species names against taxonomic databases."
    },
    {
      "name": "System",
      "description": "Health checks and service status."
    }
  ],
  "paths": {
    "/routes/from-upload": {
      "get": {
        "tags": ["System"],
        "summary": "Route Discovery",
        "description": "Returns a list of available API routes that can be called after a file upload completes. This allows integrations to dynamically discover what processing options are available.",
        "operationId": "getRoutesFromUpload",
        "responses": {
          "200": {
            "description": "List of available post-upload processing routes",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RouteDiscoveryResponse"
                }
              }
            }
          }
        }
      }
    },
    "/": {
      "get": {
        "tags": ["System"],
        "summary": "Service Health Check",
        "description": "Verifies that the API gateway and underlying matcher services are operational.",
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "service": {
                      "type": "string",
                      "example": "Superseeded Resolver Service"
                    },
                    "version": {
                      "type": "string",
                      "example": "1.0.0"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/resolve/specs": {
      "post": {
        "tags": ["Resolvers"],
        "summary": "Resolve Specs",
        "description": "Unified endpoint for resolving plant specifications. Accepts input as: (1) JSON body with items array, (2) JSON body with file_url from TUS upload, or (3) multipart form-data with direct file upload. Supported file formats: JSON, XLSX, XLS, PDF, TXT, PNG, JPG, JPEG, GIF, WEBP. Authentication: Basic/Pro plans use X-API-Key header; Teams plans with platform integration require Authorization Bearer token.",
        "operationId": "resolveSpecs",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "requestBody": {
          "description": "Object containing a list of raw spec strings to be resolved.",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResolveSpecsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful resolution with detailed hierarchy data.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResolveSpecsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid JSON format."
          },
          "401": {
            "description": "Unauthorized - Missing API Key."
          },
          "403": {
            "description": "Forbidden - Invalid API Key."
          }
        }
      }
    },
    "/validate/species": {
      "post": {
        "tags": ["Validation"],
        "summary": "Validate Species Names",
        "description": "Validate botanical species names against multiple taxonomic databases (GBIF, TNRS) with intelligent caching and confidence scoring. Accepts input as: (1) JSON body with species_names array, (2) JSON body with file_url from TUS upload, or (3) multipart form-data with direct file upload. Results are categorized by confidence level: exact (â‰¥90%), inexact (50-89%), and invalid (<50%).",
        "operationId": "validateSpecies",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "requestBody": {
          "description": "Object containing species names to validate or file reference.",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ValidateSpeciesRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful validation with categorized results.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidateSpeciesResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input or no species names found."
          },
          "401": {
            "description": "Unauthorized - Missing API Key."
          },
          "403": {
            "description": "Forbidden - Invalid API Key or usage limit exceeded."
          },
          "500": {
            "description": "Internal Server Error - Species validation failed."
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "RouteDiscoveryResponse": {
        "type": "object",
        "properties": {
          "routes": {
            "type": "array",
            "description": "List of available post-upload processing routes",
            "items": {
              "$ref": "#/components/schemas/Route"
            }
          },
          "version": {
            "type": "string",
            "description": "API version for the route schema",
            "example": "1.0"
          }
        },
        "example": {
          "routes": [
            {
              "id": "resolve-specs",
              "name": "Resolve Specifications",
              "description": "Classify pot sizes and plant specifications into Growth Equivalent Hierarchy categories",
              "endpoint": "/v1/resolve/specs",
              "method": "POST",
              "requires_auth": true,
              "accepted_file_types": [".json", ".xlsx", ".xls", ".pdf", ".txt", ".png", ".jpg", ".jpeg", ".gif", ".webp"],
              "category": "enrichment"
            }
          ],
          "version": "1.0"
        }
      },
      "Route": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique route identifier",
            "example": "resolve-specs"
          },
          "name": {
            "type": "string",
            "description": "Human-readable route name for display in UIs",
            "example": "Resolve Specifications"
          },
          "description": {
            "type": "string",
            "description": "Description of what this route does",
            "example": "Classify pot sizes and plant specifications into Growth Equivalent Hierarchy categories"
          },
          "endpoint": {
            "type": "string",
            "description": "Full API endpoint path",
            "example": "/v1/resolve/specs"
          },
          "method": {
            "type": "string",
            "description": "HTTP method",
            "example": "POST"
          },
          "requires_auth": {
            "type": "boolean",
            "description": "Whether the route requires a delegation token",
            "example": true
          },
          "accepted_file_types": {
            "type": "array",
            "description": "File extensions this route can process",
            "items": {
              "type": "string"
            },
            "example": [".json", ".xlsx", ".xls", ".pdf", ".txt", ".png", ".jpg", ".jpeg", ".gif", ".webp"]
          },
          "category": {
            "type": "string",
            "description": "Optional category for grouping routes",
            "example": "enrichment"
          }
        }
      },
      "ResolveSpecsRequest": {
        "type": "object",
        "description": "Request body for /resolve/specs. Accepts items array, file_url, or multipart file upload.",
        "properties": {
          "items": {
            "type": "array",
            "description": "An array of raw strings representing pot sizes or plant states. Takes precedence over file inputs.",
            "items": {
              "type": "string"
            }
          },
          "file_url": {
            "type": "string",
            "description": "URL to a previously uploaded file (from TUS storage). Must be from secure.superseeded.ai or api.superseeded.ai."
          },
          "filename": {
            "type": "string",
            "description": "Optional filename hint for format detection when using file_url."
          },
          "extraction_type": {
            "type": "string",
            "description": "What to extract from files: pot_sizes, species, or generic.",
            "default": "pot_sizes"
          }
        },
        "example": {
          "items": ["140mm", "400mm AS", "20L Bag", "Ex-Ground"]
        }
      },
      "ResolveSpecsResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ResolvedItem"
            }
          }
        }
      },
      "ResolvedItem": {
        "type": "object",
        "properties": {
          "input_label": {
            "type": "string",
            "description": "The original raw string provided in the request.",
            "example": "400mm AS"
          },
          "match_confidence": {
            "type": "string",
            "enum": ["Exact", "High", "Medium", "Low", "None"],
            "description": "The confidence level of the semantic match.",
            "example": "High"
          },
          "external_ids": {
            "type": "object",
            "nullable": true,
            "description": "A map of foreign key IDs from external systems.",
            "properties": {
              "evergreenconnect_potsize_id": {
                "type": "integer",
                "description": "The precise Evergreen Connect ID if an exact match is found.",
                "example": 823
              }
            }
          },
          "standard_data": {
            "$ref": "#/components/schemas/ContainerProfile"
          }
        }
      },
      "ContainerProfile": {
        "type": "object",
        "description": "The standardized biological and logistical profile for this container type.",
        "properties": {
          "type": {
            "type": "string",
            "description": "The standardized unique key for this container type.",
            "example": "Pot - Air Pruning"
          },
          "stage_order": {
            "type": "integer",
            "description": "Numeric sort order for biological maturity (0=Seed, 5=Mature, 99=Non-Plant).",
            "example": 4
          },
          "stage_name": {
            "type": "string",
            "description": "Human-readable category of the production stage.",
            "example": "Advanced Production"
          },
          "is_biological": {
            "type": "boolean",
            "description": "Indicates if the item is a living plant vs hard goods.",
            "example": true
          },
          "matching_strategy": {
            "type": "string",
            "description": "Hint for how to compare stock of this type (e.g., Volume vs Diameter).",
            "example": "Volume"
          },
          "logistics": {
            "type": "object",
            "properties": {
              "tier": {
                "type": "string",
                "enum": ["Parcel", "Pallet", "Specialized", "N/A"],
                "example": "Pallet"
              },
              "is_stackable": {
                "type": "boolean",
                "description": "If true, items can be stacked vertically, reducing freight cost.",
                "example": false
              },
              "freight_efficiency": {
                "type": "string",
                "example": "Medium"
              }
            }
          },
          "quality_profile": {
            "type": "object",
            "properties": {
              "transplant_shock_risk": {
                "type": "string",
                "example": "Very Low"
              },
              "seasonal_restriction": {
                "type": "string",
                "example": "None"
              },
              "inspection_focus": {
                "type": "string",
                "description": "The primary attribute to check during quality inspection.",
                "example": "Desiccation"
              }
            }
          },
          "customer_note": {
            "type": "string",
            "description": "User-friendly note explaining the pros/cons of this type.",
            "example": "Superior root structure; requires more frequent watering until planted."
          }
        }
      },
      "ValidateSpeciesRequest": {
        "type": "object",
        "properties": {
          "species_names": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of species names to validate",
            "example": ["Eucalyptus globulus", "Acacia melanoxylon"]
          },
          "file_url": {
            "type": "string",
            "description": "URL to uploaded file containing species names",
            "example": "https://secure.superseeded.ai/files/abc123"
          },
          "filename": {
            "type": "string",
            "description": "Original filename for context",
            "example": "species_list.xlsx"
          },
          "extraction_column": {
            "type": "string",
            "description": "Column name containing species names",
            "example": "Botanical Name"
          },
          "include_metadata": {
            "type": "boolean",
            "default": true,
            "description": "Include detailed taxonomic metadata"
          },
          "cache_results": {
            "type": "boolean",
            "default": true,
            "description": "Cache results for future queries"
          }
        }
      },
      "ValidateSpeciesResponse": {
        "type": "object",
        "properties": {
          "results": {
            "$ref": "#/components/schemas/SpeciesValidationResult"
          },
          "metadata": {
            "type": "object",
            "properties": {
              "input_count": {
                "type": "integer",
                "description": "Number of input species names"
              },
              "exact_matches": {
                "type": "integer",
                "description": "Count of exact matches"
              },
              "inexact_matches": {
                "type": "integer",
                "description": "Count of inexact matches"
              },
              "invalid_matches": {
                "type": "integer",
                "description": "Count of invalid matches"
              },
              "processing_time_seconds": {
                "type": "number",
                "description": "Processing time"
              },
              "sources_used": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Data sources used"
              },
              "cache_enabled": {
                "type": "boolean",
                "description": "Whether caching was enabled"
              }
            }
          }
        }
      },
      "SpeciesValidationResult": {
        "type": "object",
        "properties": {
          "exact": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpeciesNameMatch"
            },
            "description": "High confidence exact matches"
          },
          "inexact": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpeciesNameMatch"
            },
            "description": "Partial matches requiring review"
          },
          "invalid": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpeciesNameMatch"
            },
            "description": "No valid matches found"
          },
          "total_processed": {
            "type": "integer",
            "description": "Total number of species names processed"
          },
          "processing_time_seconds": {
            "type": "number",
            "description": "Time taken to process all names"
          }
        }
      },
      "SpeciesNameMatch": {
        "type": "object",
        "properties": {
          "original": {
            "type": "string",
            "description": "Original species name provided"
          },
          "matched": {
            "type": "string",
            "description": "Matched canonical species name"
          },
          "source": {
            "type": "string",
            "enum": ["gbif", "tnrs"],
            "description": "Source of the match"
          },
          "score": {
            "type": "number",
            "minimum": 0.0,
            "maximum": 1.0,
            "description": "Match confidence score"
          },
          "confidence": {
            "type": "string",
            "enum": ["exact", "inexact", "invalid"],
            "description": "Categorical confidence level"
          },
          "author": {
            "type": "string",
            "description": "Taxonomic author"
          },
          "family": {
            "type": "string",
            "description": "Plant family"
          },
          "genus": {
            "type": "string",
            "description": "Genus name"
          },
          "rank": {
            "type": "string",
            "description": "Taxonomic rank"
          },
          "status": {
            "type": "string",
            "description": "Taxonomic status"
          },
          "url": {
            "type": "string",
            "description": "Reference URL"
          },
          "gbif_id": {
            "type": "string",
            "description": "GBIF taxon key"
          },
          "wfo_id": {
            "type": "string",
            "description": "World Flora Online ID"
          }
        },
        "required": ["original", "confidence"],
        "example": {
          "original": "Eucalyptus globulus",
          "matched": "Eucalyptus globulus",
          "source": "gbif",
          "score": 1.0,
          "confidence": "exact",
          "author": "Labill.",
          "family": "Myrtaceae",
          "genus": "Eucalyptus",
          "rank": "species",
          "status": "accepted",
          "gbif_id": "3190653"
        }
      }
    },
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "Standard API Key authentication."
      }
    }
  }
}