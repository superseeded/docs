---
title: "Resolve Specs from Upload"
description: "Process uploaded files and get enriched plant specifications"
---

## Overview

After uploading a file via TUS, call this endpoint to process the file and receive enriched plant specification data. The same delegation token used for the upload authenticates this request.

<Info>
  This endpoint replaces the previous webhook-based flow. Your frontend now calls this endpoint directly after upload, giving you immediate control over when processing occurs.
</Info>

**Endpoint:** `POST /v1/resolve/specs/from-upload`

## Authentication

Use the same delegation token that was used for the TUS upload:

```http
Authorization: Bearer <delegation_token>
```

The token contains the `merchant_id` used for billing, so no additional authentication is required.

## Processing Flow

```mermaid
sequenceDiagram
    participant F as Your Frontend
    participant T as TUS Server
    participant A as SuperSeeded API
    participant P as Parser
    participant E as Enrichment
    participant D as Database
    
    F->>T: Upload file with JWT
    T-->>F: Return file URL
    F->>A: POST /v1/resolve/specs/from-upload
    A->>T: Fetch file internally
    T-->>A: File contents
    A->>P: Parse file
    P-->>A: Extracted data
    A->>D: Record usage event
    A->>E: Enrich with stock data
    E-->>A: Enriched line items
    A-->>F: Return enriched data + usage
```

<Steps>
  <Step title="Upload Complete">
    After the TUS upload completes, your frontend receives the file URL.
  </Step>
  <Step title="Call Processing Endpoint">
    Your frontend sends a POST request with the file URL and delegation token.
  </Step>
  <Step title="Internal Fetch">
    The API fetches the file from storage using the provided URL.
  </Step>
  <Step title="Parsing">
    The parser extracts structured data from the uploaded plant schedule.
  </Step>
  <Step title="Usage Recording">
    Usage is recorded against the merchant's ledger (from the JWT). See [Usage & Billing](/platform-integration/usage-billing).
  </Step>
  <Step title="Stock Enrichment">
    Line items are matched against the stock database and enriched with specifications.
  </Step>
  <Step title="Response">
    Enriched data and usage information are returned directly to your frontend.
  </Step>
</Steps>

## Request

### Headers

| Header | Value | Description |
|--------|-------|-------------|
| `Authorization` | `Bearer <token>` | The delegation token from `/v1/auth/delegate-upload` |
| `Content-Type` | `application/json` | Required for JSON body |

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `file_url` | string | Yes | The TUS upload URL returned after upload completes |

### Example Request

<CodeGroup>

```bash cURL
curl -X POST https://api.superseeded.ai/v1/resolve/specs/from-upload \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{"file_url": "https://secure.superseeded.ai/files/abc123"}'
```

```javascript JavaScript
const response = await fetch('https://api.superseeded.ai/v1/resolve/specs/from-upload', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${delegationToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    file_url: uploadResult.uploadURL
  })
});

const { success, enriched_data, usage } = await response.json();
```

```python Python
import requests

response = requests.post(
    "https://api.superseeded.ai/v1/resolve/specs/from-upload",
    headers={
        "Authorization": f"Bearer {delegation_token}",
        "Content-Type": "application/json"
    },
    json={"file_url": "https://secure.superseeded.ai/files/abc123"}
)
result = response.json()
```

</CodeGroup>

## Response

The endpoint returns enriched data with usage information:

```json
{
  "success": true,
  "usage": {
    "is_billable": true,
    "rows_processed": 42,
    "file_origin": "external",
    "month_totals": {
      "month": "2024-01",
      "is_active": true,
      "row_count": 142,
      "billable_row_count": 100
    }
  },
  "enriched_data": {
    "results": [
      {
        "input_label": "400mm AS",
        "match_confidence": "High",
        "standard_data": {
          "id": "4.1",
          "evergreen_connect_potsize_id": [61, 79, 81, 91, 96, 103],
          "type": "Pot - Air Pruning",
          "stage_order": 4,
          "stage_name": "Advanced Production",
          "is_biological": true,
          "matching_strategy": "Volume",
          "logistics": {
            "tier": "Pallet",
            "is_stackable": false,
            "freight_efficiency": "Medium"
          },
          "quality_profile": {
            "transplant_shock_risk": "Very Low",
            "seasonal_restriction": "None",
            "inspection_focus": "Desiccation"
          },
          "customer_note": "Superior root structure; requires more frequent watering until planted."
        },
        "external_ids": null
      }
    ]
  }
}
```

### Response Fields

<ResponseField name="success" type="boolean" required>
  Whether processing completed successfully
</ResponseField>

<ResponseField name="usage" type="object" required>
  Usage metrics for this processing event
</ResponseField>

<ResponseField name="usage.is_billable" type="boolean">
  Whether this document counts toward billing
</ResponseField>

<ResponseField name="usage.rows_processed" type="integer">
  Number of line items processed in this file
</ResponseField>

<ResponseField name="usage.file_origin" type="string">
  Either `"external"` or `"superseed_engine"`
</ResponseField>

<ResponseField name="usage.month_totals" type="object">
  Cumulative usage for the current billing month
</ResponseField>

<ResponseField name="enriched_data" type="object" required>
  Spec resolution results containing aligned plant specifications
</ResponseField>

<ResponseField name="enriched_data.results" type="array" required>
  Array of resolved spec objects with standard data
</ResponseField>

### Spec Resolution Result Fields

<ResponseField name="input_label" type="string">
  The original raw text label that was resolved
</ResponseField>

<ResponseField name="match_confidence" type="string">
  Confidence level of the match: `"Exact"`, `"High"`, `"Medium"`, or `"Low"`
</ResponseField>

<ResponseField name="standard_data" type="object">
  Structured biological concept data
</ResponseField>

<ResponseField name="standard_data.id" type="string">
  Unique identifier for this specification
</ResponseField>

<ResponseField name="standard_data.evergreen_connect_potsize_id" type="integer[]">
  Array of associated EvergreenConnect pot size IDs
</ResponseField>

<ResponseField name="standard_data.type" type="string">
  Container type classification
</ResponseField>

<ResponseField name="standard_data.stage_order" type="integer">
  Maturity stage number (0-5)
</ResponseField>

<ResponseField name="standard_data.stage_name" type="string">
  Human-readable maturity stage name
</ResponseField>

<ResponseField name="standard_data.is_biological" type="boolean">
  Whether this represents a biological growth stage
</ResponseField>

<ResponseField name="standard_data.matching_strategy" type="string">
  Strategy used for matching: `"Volume"`, `"Volume/Weight"`, `"Volume Critical (Wildcard)"`, etc.
</ResponseField>

<ResponseField name="standard_data.logistics" type="object">
  Freight and handling constraints
</ResponseField>

<ResponseField name="standard_data.quality_profile" type="object">
  Risk and handling information
</ResponseField>

<ResponseField name="standard_data.customer_note" type="string">
  Human-readable guidance for handling
</ResponseField>

<ResponseField name="external_ids" type="object | null">
  External system identifiers (currently null)
</ResponseField>

## Error Responses

| Status | Error | Description |
|--------|-------|-------------|
| `400` | `invalid_request` | Missing `file_url` in request body |
| `401` | `invalid_token` | JWT token validation failed or expired |
| `403` | `forbidden` | Token doesn't have access to the specified file |
| `404` | `file_not_found` | The specified file URL does not exist |
| `422` | `parsing_failed` | Could not extract data from file |
| `500` | `enrichment_error` | Stock enrichment service unavailable |

## Token Reuse

<Note>
  The delegation token serves dual purposes:
  
  1. **Upload authentication** - Authorizes the TUS upload
  2. **Processing authentication** - Authorizes this endpoint and identifies the merchant for billing
  
  This design simplifies integration since you only need to manage one token per upload session.
</Note>

## Best Practices

<AccordionGroup>
  <Accordion title="Call immediately after upload">
    For the best user experience, call this endpoint as soon as the TUS upload completes. The delegation token has a 5-minute expiration, so don't delay processing.
  </Accordion>
  <Accordion title="Handle the response in your UI">
    Since the enriched data is returned directly, you can display results to your users immediately without waiting for webhooks or polling.
  </Accordion>
  <Accordion title="Store the usage data">
    The `usage` object in the response contains billing information. Consider logging this for your own records and displaying it to merchants.
  </Accordion>
</AccordionGroup>
